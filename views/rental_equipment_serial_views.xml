<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Serial Number List View -->
    <record id="view_rental_equipment_serial_list" model="ir.ui.view">
        <field name="name">rental.equipment.serial.list</field>
        <field name="model">rental.equipment.serial</field>
        <field name="arch" type="xml">
            <list string="Serial Numbers">
                <field name="sequence" widget="handle"/>
                <field name="equipment_name"/>
                <field name="serial_number"/>
                <field name="status" widget="badge"
                       decoration-success="status in ['available', 'returned']"
                       decoration-info="status == 'reserved'"
                       decoration-warning="status == 'rented'"
                       decoration-danger="status in ['damaged', 'repairing']"
                       decoration-muted="status == 'disposed'"/>
                <field name="current_project_name" optional="show"/>
                <!-- NEW: Rental tracking columns -->
                <field name="actual_pickup_date" optional="hide"/>
                <field name="actual_return_date" optional="hide"/>
                <field name="rental_days" optional="hide"/>
                <field name="rental_charge" widget="monetary" optional="hide" sum="Total"/>
                <field name="programming_config" optional="hide"/>
                <field name="active" widget="boolean_toggle"/>
            </list>
        </field>
    </record>

    <!-- Serial Number Form View -->
    <record id="view_rental_equipment_serial_form" model="ir.ui.view">
        <field name="name">rental.equipment.serial.form</field>
        <field name="model">rental.equipment.serial</field>
        <field name="arch" type="xml">
            <form string="Serial Number">
                <header>
                    <button name="action_set_available" 
                            string="Set Available" 
                            type="object"
                            class="oe_highlight"
                            invisible="status == 'available'"/>
                    <button name="action_set_damaged" 
                            string="Mark as Damaged" 
                            type="object"
                            invisible="status == 'damaged'"/>
                    <button name="action_set_repairing" 
                            string="Send to Repair" 
                            type="object"
                            invisible="status == 'repairing'"/>
                    <!-- MODIFY THIS BUTTON - Remove confirm attribute -->
                    <button name="action_smart_delete" 
                            string="Smart Delete" 
                            type="object"
                            class="btn-danger"
                            groups="rental_management.group_rental_manager"/>
                    <!-- NEW BUTTON - Add Archive option -->
                    <button name="toggle_active" 
                            string="Archive" 
                            type="object"
                            invisible="not active"
                            groups="rental_management.group_rental_manager"/>
                    <button name="toggle_active" 
                            string="Unarchive" 
                            type="object"
                            invisible="active"
                            groups="rental_management.group_rental_manager"/>
                    <button name="action_view_status_history" 
                            string="Status History" 
                            type="object"/>
                    <field name="status" widget="statusbar" 
                        statusbar_visible="available,reserved,rented,returned"/>
                </header>
                <sheet>
                    <widget name="web_ribbon" title="Disposed" bg_color="text-bg-danger" invisible="active"/>
                    
                    <!-- QR Code Image - Large, clickable -->
                    <field name="qr_code" 
                        widget="image" 
                        class="oe_avatar" 
                        options="{'size': [150, 150], 'preview_image': 'qr_code'}"/>
                    
                    <div class="oe_title">
                        <label for="serial_number" class="oe_edit_only"/>
                        <h1>
                            <field name="serial_number" placeholder="Serial Number"/>
                        </h1>
                        <h3>
                            <field name="equipment_id" 
                                options="{'no_create': True, 'no_open': True}"/>
                        </h3>
                    </div>
                    
                    <group>
                        <group string="Current Status">
                            <field name="status" widget="badge"
                                decoration-success="status in ['available', 'returned']"
                                decoration-info="status == 'reserved'"
                                decoration-warning="status == 'rented'"
                                decoration-danger="status in ['damaged', 'repairing']"
                                decoration-muted="status == 'disposed'"/>
                            <field name="current_project_id" 
                                invisible="status not in ['reserved', 'rented']"
                                options="{'no_create': True}"/>
                            <field name="active"/>
                        </group>
                        <!-- NEW: Rental Dates Group -->
                        <group string="Rental Dates" invisible="status not in ['rented', 'returned']">
                            <field name="actual_pickup_date" readonly="1"/>
                            <field name="actual_return_date" readonly="1"/>
                            <field name="rental_days" readonly="1" decoration-bf="1"/>
                            <field name="rental_charge" widget="monetary" readonly="1" decoration-bf="1"/>
                        </group>
                        <group string="Configuration">
                            <field name="programming_config" 
                                placeholder="Special programming or configuration notes..."/>
                        </group>
                    </group>
                    
                    <group>
                        <group string="Notes">
                            <field name="notes" placeholder="Additional notes about this serial..."/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Status History" name="history">
                            <field name="status_history_ids" readonly="1">
                                <list>
                                    <field name="create_date" string="Date"/>
                                    <field name="status" widget="badge"
                                        decoration-success="status in ['available', 'returned']"
                                        decoration-info="status == 'reserved'"
                                        decoration-warning="status == 'rented'"
                                        decoration-danger="status in ['damaged', 'repairing']"
                                        decoration-muted="status == 'disposed'"/>
                                    <field name="project_name"/>
                                    <field name="user_id"/>
                                    <field name="notes"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <chatter/>
            </form>
        </field>
    </record>
        
    <!-- Serial Number Kanban View -->
    <record id="view_rental_equipment_serial_kanban" model="ir.ui.view">
        <field name="name">rental.equipment.serial.kanban</field>
        <field name="model">rental.equipment.serial</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="id"/>
                <field name="serial_number"/>
                <field name="equipment_name"/>
                <field name="status"/>
                <field name="current_project_name"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('rental.equipment.serial', 'qr_code', record.id.raw_value)" 
                                     alt="Serial" class="o_image_64_cover"/>
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="serial_number"/>
                                </strong>
                                <div class="o_kanban_record_subtitle">
                                    <field name="equipment_name"/>
                                </div>
                                <div class="o_kanban_tags_section">
                                    <span t-attf-class="badge badge-pill 
                                        #{record.status.raw_value === 'available' ? 'text-bg-success' : ''}
                                        #{record.status.raw_value === 'reserved' ? 'text-bg-info' : ''}
                                        #{record.status.raw_value === 'rented' ? 'text-bg-warning' : ''}
                                        #{record.status.raw_value === 'damaged' ? 'text-bg-danger' : ''}
                                        #{record.status.raw_value === 'disposed' ? 'text-bg-secondary' : ''}">
                                        <field name="status"/>
                                    </span>
                                </div>
                                <div t-if="record.current_project_name.raw_value" class="mt-1">
                                    <small>Project: <field name="current_project_name"/></small>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    
    <!-- Serial Number Search View -->
    <record id="view_rental_equipment_serial_search" model="ir.ui.view">
        <field name="name">rental.equipment.serial.search</field>
        <field name="model">rental.equipment.serial</field>
        <field name="arch" type="xml">
            <search string="Search Serial Numbers">
                <field name="serial_number" string="Serial"/>
                <field name="equipment_id" string="Equipment"/>
                <field name="current_project_id" string="Project"/>
                
                <filter string="Active" name="active" 
                        domain="[('active', '=', True)]"/>
                <filter string="Inactive" name="inactive" 
                        domain="[('active', '=', False)]"/>
                
                <separator/>
                <filter string="Available" name="available" 
                        domain="[('status', '=', 'available')]"/>
                <filter string="Reserved" name="reserved" 
                        domain="[('status', '=', 'reserved')]"/>
                <filter string="Rented" name="rented" 
                        domain="[('status', '=', 'rented')]"/>
                <filter string="Returned" name="returned" 
                        domain="[('status', '=', 'returned')]"/>
                <filter string="Damaged" name="damaged" 
                        domain="[('status', '=', 'damaged')]"/>
                <filter string="Under Repair" name="repairing" 
                        domain="[('status', '=', 'repairing')]"/>
                <filter string="Disposed" name="disposed" 
                        domain="[('status', '=', 'disposed')]"/>
                
                <group expand="0" string="Group By">
                    <filter string="Equipment" name="group_equipment" 
                            context="{'group_by': 'equipment_id'}"/>
                    <filter string="Status" name="group_status" 
                            context="{'group_by': 'status'}"/>
                    <filter string="Current Project" name="group_project" 
                            context="{'group_by': 'current_project_id'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- Serial Number Action -->
    <record id="action_rental_equipment_serial" model="ir.actions.act_window">
        <field name="name">Serial Numbers</field>
        <field name="res_model">rental.equipment.serial</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No serial numbers found
            </p>
            <p>
                Serial numbers are created automatically when you enable
                serial tracking on equipment and add them to rental projects.
                You can also create them manually here.
            </p>
        </field>
    </record>
    
    <!-- Serial Numbers by Status Actions (for filtered views) -->
    <record id="action_rental_serial_available" model="ir.actions.act_window">
        <field name="name">Available Serials</field>
        <field name="res_model">rental.equipment.serial</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_available': 1}</field>
        <field name="domain">[('status', '=', 'available')]</field>
    </record>
    
    <record id="action_rental_serial_rented" model="ir.actions.act_window">
        <field name="name">Rented Serials</field>
        <field name="res_model">rental.equipment.serial</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_rented': 1}</field>
        <field name="domain">[('status', '=', 'rented')]</field>
    </record>
    
    <record id="action_rental_serial_damaged" model="ir.actions.act_window">
        <field name="name">Damaged Serials</field>
        <field name="res_model">rental.equipment.serial</field>
        <field name="view_mode">list,kanban,form</field>
        <field name="context">{'search_default_damaged': 1}</field>
        <field name="domain">[('status', '=', 'damaged')]</field>
    </record>
    <!-- Add QR Code field to Serial Number Form View -->
    <record id="view_rental_equipment_serial_form_qr" model="ir.ui.view">
        <field name="name">rental.equipment.serial.form.qr</field>
        <field name="model">rental.equipment.serial</field>
        <field name="inherit_id" ref="rental_management.view_rental_equipment_serial_form"/>
        <field name="arch" type="xml">
            <xpath expr="//sheet" position="before">
                <header>
                    <button name="action_regenerate_qr_code" 
                            string="Regenerate QR" 
                            type="object" 
                            class="btn-primary"
                            groups="rental_management.group_rental_manager"/>
                    <button name="action_download_qr_code" 
                            string="Download QR" 
                            type="object" 
                            class="btn-primary"/>
                    <button name="action_print_qr_code" 
                            string="Print QR Label" 
                            type="object"/>
                </header>
            </xpath>
            
            <!-- <xpath expr="//field[@name='serial_number']" position="after">
                <field name="qr_code" widget="image" class="oe_avatar" 
                    options="{'size': [300, 300]}"/>
            </xpath> -->
        </field>
    </record>

</odoo>

<!-- 
**Key Features:**

1. âœ… **Uses `<list>` not `<tree>`** - Odoo 18 compliant
2. **Status bar** - Visual workflow indicator
3. **Action buttons** - Quick status changes (Set Available, Mark Damaged, etc.)
4. **Color-coded badges** - Status shown with colors
5. **Status history** - Track all status changes over time
6. **Current project link** - See which project has this serial
7. **Photo support** - Image per serial
8. **Ribbon widget** - "Disposed" ribbon for inactive serials
9. **Multiple search filters** - By status (Available, Rented, Damaged, etc.)
10. **Pre-filtered actions** - Quick access to Available/Rented/Damaged serials
-->
